---
title: "Wind Rose"
author: "Naomi Lubkin"
output: html_document
date: '2022-06-21'
---
Wind roses showing wind directions for different time periods. 

#Packages
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(dplyr)
library(openair)
library(climatol)
library(readr)
library(tidyr)
library(lubridate)
library(RColorBrewer)


```

#Loading in required data
```{r}
#hourly speed and direction 1935-2021
hourly_spd_dir <- read_csv("Data/b16-hourly wind speed plus direction 1935-2021.csv")
wind_2022 <- read_csv("Data/2022_wind.csv") %>%
  dplyr::select(date, wind_speed, wind_direction)
hourly_spd_dir <- rbind(hourly_spd_dir, wind_2022)

date1 <- ymd_hms("1970-05-04 00:55:00")
date2 <- ymd_hms("1970-07-09 23:55:00")

era1_start <- ymd_hms("1941-01-01 00:55:00")
era1_end <- ymd_hms("1980-05-30 23:55:00")
era2_start <- ymd_hms("1980-09-01 00:55:00")
era2_end <- ymd_hms("2022-12-31 23:55:00")


```


# Cleaning Data / setting up required dataframes 

```{r}
#for wind rose, making all data the right type and homogonizing directions to 8 cardinal directions (first ~20 years have 16), then switching cardinal directions to degrees (input data type for wind rose must be numeric). Also getting rid of NA values
hourly_spd_dir_rose <- hourly_spd_dir %>%
  mutate(era = ifelse(date %within% interval(date1, date2), NA, 
           ifelse(date %within% interval(era1_start, era1_end),"era1", 
                             ifelse(date %within% interval(era2_start, era2_end), "era2", NA)))) %>%
  #select(wind_speed, wind_direction) %>%
  mutate(wind_speed = as.numeric(wind_speed), 
         wind_direction = as.character(wind_direction)) %>%
  mutate(simple_direction =  case_when( wind_direction == "WSW" ~ "SW", 
                                        wind_direction == "WNW" ~ "NW", 
                                        wind_direction == "NNW" ~ "NW",
                                        wind_direction == "NNE" ~ "NE",
                                        wind_direction == "ENE" ~ "NE",
                                        wind_direction == "ESE" ~ "SE",
                                        wind_direction == "SSE" ~ "SE",
                                        wind_direction == "SSW" ~ "SW", 
                                        wind_direction == "N" ~ "N",
                                        wind_direction == "NE" ~ "NE",
                                        wind_direction == "E" ~ "E",
                                        wind_direction == "SE" ~ "SE",
                                        wind_direction == "S" ~ "S",
                                        wind_direction == "SW" ~ "SW",
                                        wind_direction == "W" ~ "W",
                                        wind_direction == "NW" ~ "NW")) %>%
  mutate(dir = case_when(wind_direction == "WSW" ~ 247.5, 
                         wind_direction == "WNW" ~ 292.5, 
                         wind_direction == "NNW" ~ 337.5,
                         wind_direction == "NNE" ~ 22.5,
                         wind_direction == "ENE" ~ 67.5,
                         wind_direction == "ESE" ~ 112.5,
                         wind_direction == "SSE" ~ 157.5,
                         wind_direction == "SSW" ~ 202.5, 
                         wind_direction == "N" ~ 0,
                         wind_direction == "NE" ~ 45,
                         wind_direction == "E" ~ 90,
                         wind_direction == "SE" ~ 135,
                         wind_direction == "S" ~ 180,
                         wind_direction == "SW" ~ 225,
                         wind_direction == "W" ~ 270,
                         wind_direction == "NW" ~ 315)) %>%
  mutate(wind_speed = as.numeric(wind_speed), 
         dir = as.numeric(dir)) %>%
  drop_na() %>%
  mutate(year = year(date), 
         month=month(date)) %>%
  mutate(season = case_when(month == 12 ~  "Winter", 
                            month == 1 ~ "Winter", 
                            month == 2 ~  "Winter", 
                            month == 3 ~  "Spring",
                            month == 4 ~  "Spring",
                            month == 5 ~  "Spring",
                            month == 6 ~ "Summer",
                            month == 7 ~ "Summer",
                            month == 8 ~ "Summer",
                            month == 9  ~ "Fall", 
                            month == 10  ~ "Fall", 
                            month == 11  ~ "Fall"))


#wind speeds/directions 1981-2021
#hourly, grouped by "era" so plotting later is easier
hourly_spd_dir_byyear <- hourly_spd_dir_rose %>%
  mutate(era = case_when (year %in% 1941:1980 ~ "1941-1980", 
                            year >= 1981 ~ "1981-2021", 
                            TRUE ~ NA_character_))

#hourly data 1981-2021
hourly_since_1981 <- hourly_spd_dir_rose %>%
  filter(year >= 1981)

#monthly data, grouped by year
monthly_spd_dir_byyear <- hourly_spd_dir_rose %>%
  mutate(era = case_when (year <= 1940 ~ "1935-1940", 
                            year %in% 1941:1980 ~ "1941-1980", 
                            year >= 1981 ~ "1981-2021", 
                            TRUE ~ NA_character_))

```

#Wind Rose
```{r}
#this is wind rose from open air package
#1941-1980 and 1981-2021 breaks
wind_rose <- windRose(hourly_spd_dir_byyear, wd="dir", ws="wind_speed", type =  "era", paddle= FALSE, annotate=FALSE, width=2, bias.corr = TRUE, key.position="left", normalize = FALSE, breaks = c(0, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100), key.header = "Wind Speed (mph)", key.footer = NULL)


wind_rose


wind_rose_81season <- windRose(hourly_since_1981, wd="dir", ws="wind_speed", type = "season", paddle= FALSE, annotate= FALSE, width=2, bias.corr = TRUE, key.position="left", normalize = FALSE, breaks = c(0, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100), key.header = "Wind Speed (mph)", key.footer = NULL)

wind_rose_81season

wind_rose_seasonyear <- windRose(hourly_spd_dir_byyear, wd="dir", ws="wind_speed", type =  c("era", "season"), paddle= FALSE, annotate=FALSE, width=2, bias.corr = TRUE, key.position="left", normalize = FALSE, breaks = c(0, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100), key.header = "Wind Speed (mph)", key.footer = NULL)



wind_rose_seasonyear
```