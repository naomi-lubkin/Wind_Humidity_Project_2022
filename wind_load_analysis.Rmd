---
title: "Wind load analysis"
author: "Larz von Huene and Naomi Lubkin"
date: "5/1/2023"
output: html_document
---

This rmd calculates wind load and analyzes trends over the years.
The drag coefficient was obtained from a study by Gillies et al. (2002) that looked at three different plant species. For this analysis we used their drag coefficient of a Colorado Spruce.

# Packages
```{r}
library(tidyverse)
library(lubridate)
library(dplyr)
library(ggplot2)
library(readr)
library(patchwork)
library(trend)
```

# Load Data
```{r, message=FALSE}
##loading in 
wind_2022 <- read_csv("Data/2022_wind.csv")
hourly_wind <- read_csv("Data/b16-hourly wind 1935-2021.csv")



##cleaning and merging
#hourly wind data, 1941-2021
hourly_wind_41on <- hourly_wind %>%
  #separate(date, c("year", "month", "day", "hour")) %>% #separating dates and times
  separate(date, into = c("date", "time"), sep = " ") %>%
  mutate(date = as.Date(date),
          month=month(date),
          year = year(date))  %>%
   filter(year >= 1941) %>%
    mutate(year=as.numeric(year), 
         month=as.numeric(month), 
         wind_speed=as.numeric(wind_speed))

#hourly wind data, 2022
hourly_wind_22 <- wind_2022 %>%
  separate(date, into = c("date", "time"), sep = " ") %>%
  mutate(date = as.Date(date),
          month=month(date),
          year = year(date)) %>%
  dplyr::select(date, time, wind_speed, month, year) %>% #same columns as 1941 data for merge
  mutate(year=as.numeric(year), 
         month=as.numeric(month), 
         wind_speed=as.numeric(wind_speed))

#merging : dataframe with 1941-2022 hourly wind averages
hourly_wind <- rbind(hourly_wind_41on, hourly_wind_22)


#calculating wind speed in m/s from mph (1 mph = 0.44704 m/s)
hourly_wind <- hourly_wind %>%
  mutate(wind_speed = ifelse(year <=1981, wind_speed*1.05, wind_speed)) %>% # homogenize the data
  mutate(homogenized_ms = wind_speed * 0.44704) # convert to m/s
  
```

# Calculate Wind Load 
Equation: Force = Area x Wind Pressure x Drag Coefficient
- Wind Pressure = 0.00256 x (Wind Speed)^2
- Drag coefficient used is 0.39, from Gillies et al. 2002 (found the drag coefficient for Colorado Spruce was 0.39)
- Starting out using an area of 0.25 m^2 (0.5m x 0.5m). This may be adjusted later. 
- Use wind speed in meters/second, not miles/hour

Equation: Force (wind load) = 0.25 m^2 x 0.00256 x (wind speed)^2 x 0.39
(also tried it with 1m^2 area; shape of plot is no different)

```{r}
#calculating wind load
wind_load_data <- hourly_wind %>%
  mutate(wind_load = 0.25 * 0.00256 * 0.39 * homogenized_ms^2)

```

#getting seasonal, annual, monthly wind loads: 1941 to 1981
```{r}
#seasonal averages
#first, daily averages from hourly so seasonal code works
wl_daily <- wind_load_data %>%
  na.omit() %>%
   group_by(date) %>%
  summarize(wind_load = mean(wind_load),  #averaging hourly wind speeds by day
            .groups = "drop") %>%
  mutate(month=month(date), #adding month column
         month= as.numeric(month), #making sure month is numeric
        year = year(date),  #adding year column
         year=as.numeric(year),  #making sure year is numeric
         wind_load=as.numeric(wind_load)) #making sure wind load is numeric

#monthly averages from daily
wind_load_monthly <- wl_daily %>%
  na.omit() %>%
  group_by(year, month) %>%
  summarize(wind_load = mean(wind_load)) 

#seasonal averages
wind_load_seasonal <- wind_load_monthly %>%
  mutate(year_for_season =  case_when(month == 12 ~ year + 1, TRUE ~ year)) %>%
  mutate(season = case_when(month == 12 ~ "Winter", 
                            month == 1 ~ "Winter", 
                            month == 2 ~ "Winter", 
                            month == 3 ~ "Spring", 
                            month == 4 ~ "Spring",
                            month == 5 ~ "Spring",
                            month == 6 ~ "Summer",
                            month == 7 ~ "Summer",
                            month == 8 ~ "Summer",
                            month == 9 ~ "Fall",
                            month == 10 ~ "Fall",
                            month == 11 ~ "Fall")) %>%
   group_by(year, season) %>%
  summarise(seasonal_avg_wl = mean(wind_load)) 
  
  


#annual averages
wind_load_annual <- wind_load_monthly%>% 
  group_by(year) %>% 
  summarize(wind_load = mean(wind_load))

```

#getting daily, monthly, annual wind loads: 1981-2022
```{r}
#daily
wl_daily_81 <- wl_daily %>%
  filter(year >= 1981 )

#monthly
wl_monthly_81 <- wind_load_monthly %>%
  filter(year >= 1981 )

#annual
wl_annual_81 <- wind_load_annual %>%
  filter(year >= 1981)

```


# Wind Load Figures 
```{r}
#wind load through time: this is with homogenized wind speeds 1941-2022
pdf(file = "Figures/annual_wind_load.pdf", width = 8, height = 5)
wl_annual_plot <- ggplot(data = wind_load_annual, aes(x = year, y = wind_load)) + 
  geom_point() +
  labs(x="Year",y="Wind Load") +
  theme_classic() +
  stat_smooth(method = "lm", se = FALSE)
dev.off()

#seasonal wind load
pdf(file = "Figures/seasonal_wind_load.pdf", width = 8, height = 5)
wl_seasonal_plot <- ggplot(data = wind_load_seasonal, aes(x=year, y=seasonal_avg_wl)) +
  geom_point()+
  facet_wrap(~season) +
  theme_classic()+
  labs(x="Year", y="Wind Load")
dev.off()



#pdf(file = "Figures/monthly_wind_load", width = 8, height = 5)
wl_monthly_plot <- ggplot(data = wind_load_monthly, aes(x=year, y=wind_load)) +
  geom_point()+
  facet_wrap( ~month) +
  theme_classic()+
  labs(x="Year", y="Wind Load")
#dev.off()



```

#wind load stats
```{r}
#linear model 
#hourly wind load data, homogenized
wl.lm <- lm(wind_load ~ year, wind_load_data)
summary(wl.lm) #significant value, but very low r^2 and estimate # (statistically significant, probably not biologically)

#seasonal wind data, homogenized
#making dataframes for linear model
wl_winter <- wind_load_seasonal %>% #winter dataframe
  filter(season=="Winter")

wl_spring <- wind_load_seasonal %>% #spring dataframe
  filter(season=="Spring")

wl_summer <- wind_load_seasonal %>% #summer dataframe
  filter(season=="Summer")

wl_fall <- wind_load_seasonal %>% #fall dataframe
  filter(season=="Fall")

#linear model
wl.winter.lm <- lm(seasonal_avg_wl ~ year, wl_winter) #winter (DJF)
summary(wl.winter.lm) #not significant

wl.spring.lm <- lm(seasonal_avg_wl ~ year, wl_spring) #spring (MAM)
summary(wl.spring.lm) #not significant

wl.summer.lm <- lm(seasonal_avg_wl ~ year, wl_summer) #summer (JJA)
summary(wl.summer.lm) #not significant

wl.fall.lm <- lm(seasonal_avg_wl ~ year, wl_fall) #fall (SON)
summary(wl.fall.lm) #not significant

<<<<<<< HEAD
=======
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#MONTHLY: dataframes
wl_jan_41 <- wind_load_monthly %>%
  filter(month == 1)

wl_jan_81 <- wl_monthly_81 %>%
  filter(month == 1)

wl_feb_41 <- wind_load_monthly %>%
  filter(month == 2)

wl_feb_81 <- wl_monthly_81 %>%
  filter(month == 2)

wl_mar_41 <- wind_load_monthly %>%
  filter(month == 3)

wl_mar_81 <- wl_monthly_81 %>%
  filter(month == 3)

wl_apr_41 <- wind_load_monthly %>%
  filter(month == 4)

wl_apr_81 <- wl_monthly_81 %>%
  filter(month == 4)

wl_may_41 <- wind_load_monthly %>%
  filter(month == 5)

wl_may_81 <- wl_monthly_81 %>%
  filter(month == 5)

wl_jun_41 <- wind_load_monthly %>%
  filter(month == 6)

wl_jun_81 <- wl_monthly_81 %>%
  filter(month == 6)

wl_jul_41 <- wind_load_monthly %>%
  filter(month == 7)

wl_jul_81 <- wl_monthly_81 %>%
  filter(month == 7)

wl_aug_41 <- wind_load_monthly %>%
  filter(month == 8)

wl_aug_81 <- wl_monthly_81 %>%
  filter(month == 8)

wl_sep_41 <- wind_load_monthly %>%
  filter(month == 9)

wl_sep_81 <- wl_monthly_81 %>%
  filter(month == 9)

wl_oct_41 <- wind_load_monthly %>%
  filter(month == 10)

wl_oct_81 <- wl_monthly_81 %>%
  filter(month == 10)

wl_nov_41 <- wind_load_monthly %>%
  filter(month == 11)

wl_nov_81 <- wl_monthly_81 %>%
  filter(month == 11)

wl_dec_41 <- wind_load_monthly %>%
  filter(month == 12)

wl_dec_81 <- wl_monthly_81 %>%
  filter(month == 12)

#wl monthly sen slopes: 1941- 2022
#nothing significant, two that were closest are oct and nov
wl_jan_41.sen <- sens.slope(wl_jan_41$wind_load, conf.level = 0.95)
View(wl_jan_41.sen)

wl_feb_41.sen <- sens.slope(wl_feb_41$wind_load, conf.level = 0.95)
View(wl_feb_41.sen)

wl_mar_41.sen <- sens.slope(wl_mar_41$wind_load, conf.level = 0.95)
View(wl_mar_41.sen)

wl_apr_41.sen <- sens.slope(wl_apr_41$wind_load, conf.level = 0.95)
View(wl_apr_41.sen)

wl_may_41.sen <- sens.slope(wl_may_41$wind_load, conf.level = 0.95)
View(wl_may_41.sen)

wl_jun_41.sen <- sens.slope(wl_jun_41$wind_load, conf.level = 0.95)
View(wl_jun_41.sen)

wl_jul_41.sen <- sens.slope(wl_jul_41$wind_load, conf.level = 0.95)
View(wl_jul_41.sen)

wl_aug_41.sen <- sens.slope(wl_aug_41$wind_load, conf.level = 0.95)
View(wl_aug_41.sen)

wl_sep_41.sen <- sens.slope(wl_sep_41$wind_load, conf.level = 0.95)
View(wl_sep_41.sen)

wl_oct_41.sen <- sens.slope(wl_oct_41$wind_load, conf.level = 0.95)
View(wl_oct_41.sen)
#p=0.17, estimate = 0.0001

wl_nov_41.sen <- sens.slope(wl_nov_41$wind_load, conf.level = 0.95)
View(wl_nov_41.sen)
#p=0.069, estimate = 0.0002

wl_dec_41.sen <- sens.slope(wl_dec_41$wind_load, conf.level = 0.95)
View(wl_dec_41.sen)

#~~~~
#wl monthly sen slopes: 1981 - 2022
wl_jan_81.sen <- sens.slope(wl_jan_81$wind_load, conf.level = 0.95)
View(wl_jan_81.sen)
#estimate = -0.0005, p = 0.0486

wl_feb_81.sen <- sens.slope(wl_feb_81$wind_load, conf.level = 0.95)
View(wl_feb_81.sen)

wl_mar_81.sen <- sens.slope(wl_mar_81$wind_load, conf.level = 0.95)
View(wl_mar_81.sen)

wl_apr_81.sen <- sens.slope(wl_apr_81$wind_load, conf.level = 0.95)
View(wl_apr_81.sen)
#estimate = 0.0005, p= 0.0687

wl_may_81.sen <- sens.slope(wl_may_81$wind_load, conf.level = 0.95)
View(wl_may_81.sen)

wl_jun_81.sen <- sens.slope(wl_jun_81$wind_load, conf.level = 0.95)
View(wl_jun_81.sen)

wl_jul_81.sen <- sens.slope(wl_jul_81$wind_load, conf.level = 0.95)
View(wl_jul_81.sen)

wl_aug_81.sen <- sens.slope(wl_aug_81$wind_load, conf.level = 0.95)
View(wl_aug_81.sen)

wl_sep_81.sen <- sens.slope(wl_sep_81$wind_load, conf.level = 0.95)
View(wl_sep_81.sen)

wl_oct_81.sen <- sens.slope(wl_oct_81$wind_load, conf.level = 0.95)
View(wl_oct_81.sen)

wl_nov_81.sen <- sens.slope(wl_nov_81$wind_load, conf.level = 0.95)
View(wl_nov_81.sen)

wl_dec_81.sen <- sens.slope(wl_dec_81$wind_load, conf.level = 0.95)
View(wl_dec_81.sen)
#estimate = -0.0005, p = 0.019

>>>>>>> 2193ebd4d4b16f28b0c4d960d5b37107dd4c5da4
```


# Table (using sens slope instead) 
```{r}
## 1941-2022
## Annual trends

annual_trends <- wind_load_annual %>% 
  mutate(season = 'Annual') %>% 
  summarize(annual_trend = sens.slope(wind_load, conf.level = 0.95)[["estimates"]],
            p = sens.slope(wind_load, conf.level = 0.95)[["p.value"]]) 

## Seasonal trends

seasonal_trends <- wind_load_seasonal %>%
  group_by(season) %>%
  summarize(annual_trend = sens.slope(seasonal_avg_wl, conf.level = 0.95)[["estimates"]],
            p = sens.slope(seasonal_avg_wl, conf.level = 0.95)[["p.value"]])

## Combining to make table

annual_trends_all <- bind_rows(annual_trends, seasonal_trends)  %>%
  mutate(decadal_trend = annual_trend*10,
         " " = ifelse(is.na(season), "Annual", season),
         decadal_trend = format(round(decadal_trend, 3), nsmall = 3), # round trend to 3 decimal places
         "Decadal trend" = ifelse(p <= 0.05, str_c(decadal_trend, "*"), decadal_trend), # add asterisks
         "p-value" = p) %>%
  dplyr::select(" ", "Decadal trend") %>%
  distinct() %>%   # removes rows with repeat values
  as.data.frame(html_table())

wl_table <- annual_trends_all %>%
  kbl(caption = "Decadal Trends of wind load from 1941-2022") %>%
  footnote(general = c("*indicates 95% confidence", "Sen's Slope analysis used to calculate annual wind load trends")) %>%
  kable_classic(full_width = F, html_font = "Cambria") 

save_kable(wl_table, file = "Figures/wind_load_table.pdf")



##1981-2022

## Annual trends

annual_trends <- wind_load_annual %>% 
  filter(year >= 1981) %>% 
  mutate(season = 'Annual') %>% 
  summarize(annual_trend = sens.slope(wind_load, conf.level = 0.95)[["estimates"]],
            p = sens.slope(wind_load, conf.level = 0.95)[["p.value"]]) 

## Seasonal trends

seasonal_trends <- wind_load_seasonal %>%
  filter(year >= 1981) %>% 
  group_by(season) %>%
  summarize(annual_trend = sens.slope(seasonal_avg_wl, conf.level = 0.95)[["estimates"]],
            p = sens.slope(seasonal_avg_wl, conf.level = 0.95)[["p.value"]])

## Combining to make table

annual_trends_all <- bind_rows(annual_trends, seasonal_trends)  %>%
  mutate(decadal_trend = annual_trend*10,
         " " = ifelse(is.na(season), "Annual", season),
         decadal_trend = format(round(decadal_trend, 3), nsmall = 3), # round trend to 3 decimal places
         "Decadal trend" = ifelse(p <= 0.05, str_c(decadal_trend, "*"), decadal_trend), # add asterisks
         "p-value" = p) %>%
  dplyr::select(" ", "Decadal trend") %>%
  distinct() %>%   # removes rows with repeat values
  as.data.frame(html_table())

wl_table <- annual_trends_all %>%
  kbl(caption = "Decadal Trends of wind load from 1981-2022") %>%
  footnote(general = c("*indicates 95% confidence", "Sen's Slope analysis used to calculate annual wind load trends")) %>%
  kable_classic(full_width = F, html_font = "Cambria") 

save_kable(wl_table, file = "Figures/wind_load_table_1981.pdf")
```

