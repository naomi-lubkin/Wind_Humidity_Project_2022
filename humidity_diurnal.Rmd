---
title: "humidity_diurnal"
author: "Larz von Huene and Naomi Lubkin"
date: "2023-09-07"
output: html_document
---

# Packaages
```{r setup, include=FALSE}
library(tidyverse)
library(lubridate)
library(trend)
library(patchwork)
library(kableExtra)
library(readr)
```


# Load in Data
```{r}
rh <- read_csv("Data/rh_from_humidity_analysis_rmd.csv") %>% 
  filter(year(date) >= 1941)
```

```{r}
# times: 1:00 (night), 7:00 (day), 13:00 (day), 19:00 (night)


# adding in day vs. night and seasons column
rh <- rh %>% 
  mutate(tod = case_when(
           hour(date) == 1 ~ "Night",
           hour(date) == 19 ~ "Night",
           hour(date) == 7 ~ "Day",
           hour(date) == 13 ~ "Day",
           TRUE ~ NA_character_)) %>% 
  mutate(season = case_when(month(date) == 12 ~ "Winter", 
                            month(date) == 1 ~ "Winter", 
                            month(date) == 2 ~ "Winter", 
                            month(date) == 3 ~ "Spring", 
                            month(date) == 4 ~ "Spring",
                            month(date) == 5 ~ "Spring",
                            month(date) == 6 ~ "Summer",
                            month(date) == 7 ~ "Summer",
                            month(date) == 8 ~ "Summer",
                            month(date) == 9 ~ "Fall",
                            month(date) == 10 ~ "Fall",
                            month(date) == 11 ~ "Fall"))

# diurnal trends graph
avg_hour <- rh %>% 
  group_by(season, year = year(date), hour = hour(date)) %>% 
  summarize(avg = mean(RH)) 
  
ggplot(avg, aes(x = year, y = avg, color = as.factor(hour))) +
  geom_smooth(method = "lm", se = F) +
  #geom_point()  +
  facet_wrap(~season)

# synoptic trends plot
trends <- avg_hour %>% 
  group_by(season, hour) %>% 
  summarize(trend = sens.slope(avg, conf.level = 0.95)[["estimates"]][["Sen's slope"]])
ggplot(trends, aes(x= hour, y = trend, fill = season)) +
  geom_col(position = "dodge")


avg_tod <- rh %>% 
  group_by(season, year = year(date), tod) %>% 
  summarize(avg = mean(RH)) 

# time of day trends plot
trends <- avg_tod %>% 
  group_by(season, tod) %>% 
  summarize(trend = sens.slope(avg, conf.level = 0.95)[["estimates"]][["Sen's slope"]])
ggplot(trends, aes(x= tod, y = trend, fill = season)) +
  geom_col(position = "dodge")



rh %>% 
  group_by(season, hour = hour(date)) %>% 
  summarize(avg = mean(RH)) %>% 
  ggplot(aes(x = hour, y = avg, color = season)) +
  geom_smooth() 


```

